{"ast":null,"code":"\"use strict\"; // Copyright 2014-2016, Google, Inc.\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//    http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nvar _createForOfIteratorHelper = require(\"/Users/amandapoetker-alles/Desktop/campaign-dashboard/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createForOfIteratorHelper\");\n\nvar _regeneratorRuntime = require(\"/Users/amandapoetker-alles/Desktop/campaign-dashboard/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\");\n\nvar _classCallCheck = require(\"/Users/amandapoetker-alles/Desktop/campaign-dashboard/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/classCallCheck\");\n\nvar _createClass = require(\"/Users/amandapoetker-alles/Desktop/campaign-dashboard/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createClass\");\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : new P(function (resolve) {\n        resolve(result.value);\n      }).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar fs = require(\"fs\");\n\nvar google_auth_library_1 = require(\"google-auth-library\");\n\nvar pify = require(\"pify\");\n\nvar url = require(\"url\");\n\nvar util = require(\"util\");\n\nvar apirequest_1 = require(\"./apirequest\");\n\nvar endpoint_1 = require(\"./endpoint\");\n\nvar fsp = pify(fs);\n\nvar Discovery = /*#__PURE__*/function () {\n  /**\n   * Discovery for discovering API endpoints\n   *\n   * @param options Options for discovery\n   */\n  function Discovery(options) {\n    _classCallCheck(this, Discovery);\n\n    this.transporter = new google_auth_library_1.DefaultTransporter();\n    this.options = options || {};\n  }\n  /**\n   * Generate and Endpoint from an endpoint schema object.\n   *\n   * @param schema The schema from which to generate the Endpoint.\n   * @return A function that creates an endpoint.\n   */\n\n\n  _createClass(Discovery, [{\n    key: \"makeEndpoint\",\n    value: function makeEndpoint(schema) {\n      return function (options) {\n        var ep = new endpoint_1.Endpoint(options);\n        ep.applySchema(ep, schema, schema, ep);\n        return ep;\n      };\n    }\n    /**\n     * Log output of generator. Works just like console.log\n     */\n\n  }, {\n    key: \"log\",\n    value: function log() {\n      if (this.options && this.options.debug) {\n        var _console;\n\n        (_console = console).log.apply(_console, arguments);\n      }\n    }\n    /**\n     * Generate all APIs and return as in-memory object.\n     * @param discoveryUrl\n     */\n\n  }, {\n    key: \"discoverAllAPIs\",\n    value: function discoverAllAPIs(discoveryUrl) {\n      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n        var _this = this;\n\n        var headers, res, items, apis, versionIndex, apisIndex, _iterator, _step, _loop;\n\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                headers = this.options.includePrivate ? {} : {\n                  'X-User-Ip': '0.0.0.0'\n                };\n                _context2.next = 3;\n                return this.transporter.request({\n                  url: discoveryUrl,\n                  headers\n                });\n\n              case 3:\n                res = _context2.sent;\n                items = res.data.items;\n                _context2.next = 7;\n                return Promise.all(items.map(function (api) {\n                  return __awaiter(_this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n                    var endpointCreator;\n                    return _regeneratorRuntime.wrap(function _callee$(_context) {\n                      while (1) {\n                        switch (_context.prev = _context.next) {\n                          case 0:\n                            _context.next = 2;\n                            return this.discoverAPI(api.discoveryRestUrl);\n\n                          case 2:\n                            endpointCreator = _context.sent;\n                            return _context.abrupt(\"return\", {\n                              api,\n                              endpointCreator\n                            });\n\n                          case 4:\n                          case \"end\":\n                            return _context.stop();\n                        }\n                      }\n                    }, _callee, this);\n                  }));\n                }));\n\n              case 7:\n                apis = _context2.sent;\n                versionIndex = {}; // tslint:disable-next-line no-any\n\n                apisIndex = {};\n                _iterator = _createForOfIteratorHelper(apis);\n\n                try {\n                  _loop = function _loop() {\n                    var set = _step.value;\n\n                    if (!apisIndex[set.api.name]) {\n                      versionIndex[set.api.name] = {};\n\n                      apisIndex[set.api.name] = function (options) {\n                        var type = typeof options;\n                        var version;\n\n                        if (type === 'string') {\n                          version = options;\n                          options = {};\n                        } else if (type === 'object') {\n                          version = options.version;\n                          delete options.version;\n                        } else {\n                          throw new Error('Argument error: Accepts only string or object');\n                        }\n\n                        try {\n                          var ep = // tslint:disable-next-line: no-any\n                          set.endpointCreator(options, _this);\n                          return Object.freeze(ep); // create new & freeze\n                        } catch (e) {\n                          throw new Error(util.format('Unable to load endpoint %s(\"%s\"): %s', set.api.name, version, e.message));\n                        }\n                      };\n                    }\n\n                    versionIndex[set.api.name][set.api.version] = set.endpointCreator;\n                  };\n\n                  for (_iterator.s(); !(_step = _iterator.n()).done;) {\n                    _loop();\n                  }\n                } catch (err) {\n                  _iterator.e(err);\n                } finally {\n                  _iterator.f();\n                }\n\n                return _context2.abrupt(\"return\", apisIndex);\n\n              case 13:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n    }\n    /**\n     * Generate API file given discovery URL\n     *\n     * @param apiDiscoveryUrl URL or filename of discovery doc for API\n     * @returns A promise that resolves with a function that creates the endpoint\n     */\n\n  }, {\n    key: \"discoverAPI\",\n    value: function discoverAPI(apiDiscoveryUrl) {\n      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n        var parts, file, res, options, _url, parameters, pcr, _res;\n\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                if (!(typeof apiDiscoveryUrl === 'string')) {\n                  _context3.next = 17;\n                  break;\n                }\n\n                parts = url.parse(apiDiscoveryUrl);\n\n                if (!(apiDiscoveryUrl && !parts.protocol)) {\n                  _context3.next = 10;\n                  break;\n                }\n\n                this.log('Reading from file ' + apiDiscoveryUrl);\n                _context3.next = 6;\n                return fsp.readFile(apiDiscoveryUrl, {\n                  encoding: 'utf8'\n                });\n\n              case 6:\n                file = _context3.sent;\n                return _context3.abrupt(\"return\", this.makeEndpoint(JSON.parse(file)));\n\n              case 10:\n                this.log('Requesting ' + apiDiscoveryUrl);\n                _context3.next = 13;\n                return this.transporter.request({\n                  url: apiDiscoveryUrl\n                });\n\n              case 13:\n                res = _context3.sent;\n                return _context3.abrupt(\"return\", this.makeEndpoint(res.data));\n\n              case 15:\n                _context3.next = 27;\n                break;\n\n              case 17:\n                options = apiDiscoveryUrl;\n                this.log('Requesting ' + options.url);\n                _url = options.url;\n                delete options.url;\n                parameters = {\n                  options: {\n                    url: _url,\n                    method: 'GET'\n                  },\n                  requiredParams: [],\n                  pathParams: [],\n                  params: options,\n                  context: {\n                    google: {\n                      _options: {}\n                    },\n                    _options: {}\n                  }\n                };\n                pcr = pify(apirequest_1.createAPIRequest);\n                _context3.next = 25;\n                return pcr(parameters);\n\n              case 25:\n                _res = _context3.sent;\n                return _context3.abrupt(\"return\", this.makeEndpoint(_res.data));\n\n              case 27:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n    }\n  }]);\n\n  return Discovery;\n}();\n\nexports.Discovery = Discovery;","map":{"version":3,"sources":["/Users/amandapoetker-alles/Desktop/campaign-dashboard/node_modules/googleapis-common/build/src/discovery.js"],"names":["__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","apply","Object","defineProperty","exports","fs","require","google_auth_library_1","pify","url","util","apirequest_1","endpoint_1","fsp","Discovery","options","transporter","DefaultTransporter","schema","ep","Endpoint","applySchema","debug","console","log","discoveryUrl","headers","includePrivate","request","res","items","data","all","map","api","discoverAPI","discoveryRestUrl","endpointCreator","apis","versionIndex","apisIndex","set","name","type","version","Error","freeze","format","message","apiDiscoveryUrl","parts","parse","protocol","readFile","encoding","file","makeEndpoint","JSON","parameters","method","requiredParams","pathParams","params","context","google","_options","pcr","createAPIRequest"],"mappings":"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","sourcesContent":["\"use strict\";\n// Copyright 2014-2016, Google, Inc.\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//    http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst fs = require(\"fs\");\nconst google_auth_library_1 = require(\"google-auth-library\");\nconst pify = require(\"pify\");\nconst url = require(\"url\");\nconst util = require(\"util\");\nconst apirequest_1 = require(\"./apirequest\");\nconst endpoint_1 = require(\"./endpoint\");\nconst fsp = pify(fs);\nclass Discovery {\n    /**\n     * Discovery for discovering API endpoints\n     *\n     * @param options Options for discovery\n     */\n    constructor(options) {\n        this.transporter = new google_auth_library_1.DefaultTransporter();\n        this.options = options || {};\n    }\n    /**\n     * Generate and Endpoint from an endpoint schema object.\n     *\n     * @param schema The schema from which to generate the Endpoint.\n     * @return A function that creates an endpoint.\n     */\n    makeEndpoint(schema) {\n        return (options) => {\n            const ep = new endpoint_1.Endpoint(options);\n            ep.applySchema(ep, schema, schema, ep);\n            return ep;\n        };\n    }\n    /**\n     * Log output of generator. Works just like console.log\n     */\n    log(...args) {\n        if (this.options && this.options.debug) {\n            console.log(...args);\n        }\n    }\n    /**\n     * Generate all APIs and return as in-memory object.\n     * @param discoveryUrl\n     */\n    discoverAllAPIs(discoveryUrl) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const headers = this.options.includePrivate ? {} : { 'X-User-Ip': '0.0.0.0' };\n            const res = yield this.transporter.request({ url: discoveryUrl, headers });\n            const items = res.data.items;\n            const apis = yield Promise.all(items.map((api) => __awaiter(this, void 0, void 0, function* () {\n                const endpointCreator = yield this.discoverAPI(api.discoveryRestUrl);\n                return { api, endpointCreator };\n            })));\n            const versionIndex = {};\n            // tslint:disable-next-line no-any\n            const apisIndex = {};\n            for (const set of apis) {\n                if (!apisIndex[set.api.name]) {\n                    versionIndex[set.api.name] = {};\n                    apisIndex[set.api.name] = (options) => {\n                        const type = typeof options;\n                        let version;\n                        if (type === 'string') {\n                            version = options;\n                            options = {};\n                        }\n                        else if (type === 'object') {\n                            version = options.version;\n                            delete options.version;\n                        }\n                        else {\n                            throw new Error('Argument error: Accepts only string or object');\n                        }\n                        try {\n                            const ep = \n                            // tslint:disable-next-line: no-any\n                            set.endpointCreator(options, this);\n                            return Object.freeze(ep); // create new & freeze\n                        }\n                        catch (e) {\n                            throw new Error(util.format('Unable to load endpoint %s(\"%s\"): %s', set.api.name, version, e.message));\n                        }\n                    };\n                }\n                versionIndex[set.api.name][set.api.version] = set.endpointCreator;\n            }\n            return apisIndex;\n        });\n    }\n    /**\n     * Generate API file given discovery URL\n     *\n     * @param apiDiscoveryUrl URL or filename of discovery doc for API\n     * @returns A promise that resolves with a function that creates the endpoint\n     */\n    discoverAPI(apiDiscoveryUrl) {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (typeof apiDiscoveryUrl === 'string') {\n                const parts = url.parse(apiDiscoveryUrl);\n                if (apiDiscoveryUrl && !parts.protocol) {\n                    this.log('Reading from file ' + apiDiscoveryUrl);\n                    const file = yield fsp.readFile(apiDiscoveryUrl, { encoding: 'utf8' });\n                    return this.makeEndpoint(JSON.parse(file));\n                }\n                else {\n                    this.log('Requesting ' + apiDiscoveryUrl);\n                    const res = yield this.transporter.request({ url: apiDiscoveryUrl });\n                    return this.makeEndpoint(res.data);\n                }\n            }\n            else {\n                const options = apiDiscoveryUrl;\n                this.log('Requesting ' + options.url);\n                const url = options.url;\n                delete options.url;\n                const parameters = {\n                    options: { url, method: 'GET' },\n                    requiredParams: [],\n                    pathParams: [],\n                    params: options,\n                    context: { google: { _options: {} }, _options: {} }\n                };\n                const pcr = pify(apirequest_1.createAPIRequest);\n                const res = yield pcr(parameters);\n                return this.makeEndpoint(res.data);\n            }\n        });\n    }\n}\nexports.Discovery = Discovery;\n//# sourceMappingURL=discovery.js.map"]},"metadata":{},"sourceType":"script"}